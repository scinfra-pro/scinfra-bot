# SCINFRA Bot Configuration
# Copy to config.yaml and fill in your values

# =============================================================================
# Required: Telegram configuration (always in YAML - secrets)
# =============================================================================
telegram:
  # Bot token from @BotFather
  token: "${TELEGRAM_BOT_TOKEN}"
  # Allowed chat IDs (only these chats can use the bot)
  allowed_chat_ids:
    - 123456789

# =============================================================================
# Webhook receiver (for switch-gate notifications)
# =============================================================================
webhooks:
  enabled: true
  listen: "0.0.0.0:8080"
  secret: "${WEBHOOK_SECRET}"

# Logging
logging:
  level: "info"  # debug, info, warn, error

# =============================================================================
# Dynamic configuration from S3 (optional)
# =============================================================================
# When enabled, edge, upstreams, and infrastructure are loaded from S3.
# If S3 is unavailable, falls back to YAML configuration below.
# Terraform generates metadata and uploads to S3 after apply.

s3:
  enabled: false  # Set to true to enable dynamic config from S3
  bucket: "your-bucket-name"
  prefix: "metadata/"
  endpoint: "https://s3.your-provider.com"  # S3-compatible endpoint
  region: "your-region"
  profile: "default"  # AWS CLI profile (~/.aws/credentials)
  # Provider metadata files to load (generated by Terraform)
  providers:
    - "cloud.json"      # Main cloud provider (with edge config)
    - "upstream1.json"  # VPS upstream 1
    - "upstream2.json"  # VPS upstream 2

# =============================================================================
# Static configuration (used when S3 is disabled or unavailable)
# =============================================================================

# Edge-gateway connection
edge:
  name: "Cloud Provider"
  host: "user@edge-gateway-ip"
  # key_path: "/path/to/ssh/key"  # Optional, uses SSH agent if not set
  vpn_mode_script: "/usr/local/bin/vpn-mode.sh"

# Upstream VPS servers
upstreams:
  primary:
    name: "Primary VPS"
    ip: "1.2.3.4"
    user: "root"
    switch_gate: true
    switch_gate_port: 9090
  secondary:
    name: "Secondary VPS"
    ip: "5.6.7.8"
    user: "root"
    switch_gate: true
    switch_gate_port: 9090

# Infrastructure monitoring
infrastructure:
  enabled: true
  prometheus_url: "http://localhost:9090"
  clouds:
    - name: "Production"
      icon: "‚òÅÔ∏è"
      servers:
        - id: gateway
          name: "gateway"
          icon: "üñ•Ô∏è"
          ip: "10.0.1.10"
          external_check: "https://gateway.example.com"
          services:
            - name: "Nginx"
              port: 443
            - name: "WireGuard"
              port: 51820
        - id: web-server
          name: "web-server"
          icon: "üåê"
          ip: "10.0.2.10"
          external_check: "https://web.example.com"
          services:
            - name: "web-app"
              port: 80
    - name: "VPS"
      icon: "‚òÅÔ∏è"
      servers:
        - id: vps-primary
          name: "vps-primary"
          icon: "üìç"
          ip: "1.2.3.4"
          external_check: "tcp://1.2.3.4:443"
          services:
            - name: "gost"
              port: 443
            - name: "switch-gate"
              port: 9090
