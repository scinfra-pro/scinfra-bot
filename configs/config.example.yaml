# SCINFRA Bot Configuration
# Copy to config.yaml and fill in your values

telegram:
  # Bot token from @BotFather
  token: "${TELEGRAM_BOT_TOKEN}"
  # Allowed chat IDs (only these chats can use the bot)
  allowed_chat_ids:
    - 123456789

# Edge-gateway connection
edge:
  # Display name for traffic statistics
  name: "Cloud Provider"
  # SSH host (user@host)
  host: "${EDGE_HOST}"
  # Path to SSH private key (optional, uses SSH agent if not set)
  # key_path: "/opt/scinfra-bot/.ssh/id_ed25519"
  # VPN mode script path on edge-gateway
  vpn_mode_script: "/usr/local/bin/vpn-mode.sh"

# Available upstream servers
# Define your VPS servers here. Keys are used as command names.
# Example: with key "primary", command will be /upstream_primary
upstreams:
  primary:
    name: "Primary VPS"           # Display name (optional)
    ip: "${PRIMARY_VPS_IP}"
    user: "root"
    switch_gate: true
    switch_gate_port: 9090
  secondary:
    name: "Secondary VPS"
    ip: "${SECONDARY_VPS_IP}"
    user: "root"
    switch_gate: true
    switch_gate_port: 9090

# Webhook receiver (for switch-gate notifications)
webhooks:
  # Enable webhook receiver
  enabled: true
  # Listen address for incoming webhooks
  listen: "0.0.0.0:8080"
  # Shared secret for authentication (must match switch-gate config)
  secret: "${WEBHOOK_SECRET}"

# Logging
logging:
  level: "info"  # debug, info, warn, error

# Infrastructure monitoring (optional)
# Enables /infra and /health commands for monitoring all servers
infrastructure:
  # Enable infrastructure monitoring
  enabled: true
  # Prometheus URL (bot queries Prometheus directly via localhost)
  prometheus_url: "http://localhost:9090"
  
  # Cloud providers and their servers
  clouds:
    - name: "Production"
      icon: "‚òÅÔ∏è"
      servers:
        - id: gateway
          name: "gateway"
          icon: "üñ•Ô∏è"
          ip: "10.0.1.10"
          # External check: HTTPS probe to verify accessibility from outside
          external_check: "https://gateway.example.com"
          services:
            - name: "Nginx"
              job: "nginx"       # Prometheus job name
            - name: "WireGuard"
              port: 51820
              
        - id: web-server
          name: "web-server"
          icon: "üåê"
          ip: "10.0.2.10"
          external_check: "https://web.example.com"
          services:
            - name: "web-app"
              port: 80
              
        - id: db-server
          name: "db-server"
          icon: "üóÑÔ∏è"
          ip: "10.0.3.10"
          external_check: "https://db.example.com"
          services:
            - name: "PostgreSQL"
              port: 5432
              
    - name: "Remote 1"
      icon: "‚òÅÔ∏è"
      servers:
        - id: vps-primary
          name: "vps-primary"
          icon: "üìç"
          ip: "${PRIMARY_VPS_IP}"
          # TCP check for gost port
          external_check: "tcp://${PRIMARY_VPS_IP}:443"
          services:
            - name: "gost"
              port: 443
            - name: "switch-gate"
              port: 9090
              
    - name: "Remote 2"
      icon: "‚òÅÔ∏è"
      servers:
        - id: vps-secondary
          name: "vps-secondary"
          icon: "üìç"
          ip: "${SECONDARY_VPS_IP}"
          external_check: "tcp://${SECONDARY_VPS_IP}:443"
          services:
            - name: "gost"
              port: 443
            - name: "switch-gate"
              port: 9090
